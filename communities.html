<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª | Tribly</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #6ae44d;
            --primary-dark: #4cb93b;
            --dark: #1a1a2e;
            --light: #f9f9f9;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            color: var(--dark);
            min-height: 100vh;
            padding-bottom: 50px;
        }

        /* --- Navbar --- */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .logo i { color: var(--primary); }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }
        .nav-item:hover { color: var(--primary); }

        .admin-btn {
            background: #2d3436;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.3s;
        }
        .admin-btn:hover { background: #000; transform: scale(1.05); }

        /* --- Header Section --- */
        .header-section {
            text-align: center;
            padding: 4rem 1rem 2rem;
        }

        .header-section h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #1a1a2e, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Communities Grid --- */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 5%;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        /* --- Community Card --- */
        .card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(106, 228, 77, 0.2);
            border-color: var(--primary);
        }

        .card-img {
            height: 200px;
            width: 100%;
            object-fit: cover;
            transition: 0.4s;
        }

        .card:hover .card-img {
            transform: scale(1.05);
        }

        .card-img-wrapper {
            overflow: hidden;
            height: 200px;
            position: relative;
        }

        .lock-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.9);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: #e74c3c;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .card-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card-desc {
            color: #636e72;
            font-size: 0.95rem;
            margin-bottom: 1rem;
            line-height: 1.5;
            flex-grow: 1;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: rgba(106, 228, 77, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .join-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: #fff;
            font-weight: 700;
            font-family: 'Cairo', sans-serif;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .join-btn:hover {
            background: var(--primary-dark);
        }
        
        .join-btn.locked {
            background: #b2bec3;
            cursor: not-allowed;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: #fff;
            padding: 2.5rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            transform: translateY(20px);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal h2 { margin-bottom: 1rem; color: var(--dark); }
        .modal p { color: #636e72; margin-bottom: 1.5rem; }

        .modal-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 1.5rem;
            border: 2px solid #dfe6e9;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            text-align: center;
            outline: none;
            transition: 0.3s;
        }

        .modal-input:focus { border-color: var(--primary); }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-cancel {
            background: #f1f2f6;
            color: #2d3436;
        }

        /* --- Admin Panel --- */
        .admin-panel-content {
            text-align: right;
        }
        
        .admin-select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            font-family: 'Cairo', sans-serif;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--dark);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            z-index: 3000;
            transition: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success i { color: var(--primary); }
        .toast.error i { color: #e74c3c; }

        @media (max-width: 768px) {
            .header-section h1 { font-size: 2rem; }
            .grid { grid-template-columns: 1fr; }
            .nav-links { display: none; } /* Simplified for mobile demo */
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo" onclick="window.location.href='home.html'">
            <i class="fas fa-tribe"></i> Tribly
        </div>
        <div class="nav-links">
            <div class="nav-item" onclick="window.location.href='home.html'">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            <div class="nav-item" style="color:var(--primary);">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª</div>
            <button class="admin-btn" onclick="openAdminPanel()">
                <i class="fas fa-cogs"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª
            </button>
        </div>
    </nav>

    <!-- Header -->
    <header class="header-section">
        <h1>Ø§ÙƒØªØ´Ù Ù‚Ø¨ÙŠÙ„ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h1>
        <p style="color: #636e72;">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ø§Øª ØªØ«ÙŠØ± Ø´ØºÙÙƒ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ù…Ø¬ØªÙ…Ø¹Ùƒ Ø§Ù„Ø®Ø§Øµ</p>
    </header>

    <!-- Communities Grid -->
    <div class="container">
        <div class="grid" id="communitiesGrid">
            <!-- Cards will be injected via JS -->
        </div>
    </div>

    <!-- Modal 1: Enter Password (For Locked Groups) -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div style="font-size: 3rem; color: #e17055; margin-bottom: 10px;">
                <i class="fas fa-lock"></i>
            </div>
            <h2>Ù…Ø¬ØªÙ…Ø¹ Ø®Ø§Øµ ğŸ”’</h2>
            <p id="lockedCommunityName">Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.</p>
            <input type="password" id="communityPasswordInput" class="modal-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±...">
            <div class="modal-actions">
                <button class="join-btn btn-cancel" onclick="closeModal('passwordModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="join-btn" onclick="verifyPassword()">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <!-- Modal 2: Admin Panel (To Set Passwords) -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal admin-panel-content">
            <h2><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</h2>
            <p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆÙ‚Ù… Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡.</p>
            
            <label style="display:block; margin-bottom:5px; font-weight:600;">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹:</label>
            <select id="adminCommunitySelect" class="admin-select">
                <!-- Options injected by JS -->
            </select>

            <label style="display:block; margin-bottom:5px; font-weight:600;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
            <input type="text" id="newAdminPassword" class="modal-input" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

            <button class="join-btn" onclick="saveAdminPassword()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <br><br>
            <button class="join-btn btn-cancel" onclick="closeModal('adminModal')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</span>
    </div>

    <script>
        // --- Mock Data & State ---
        // Default communities with some locked
        let communities = [
            {
                id: 1,
                name: "Ø¬ÙŠÙ…Ø±Ø² Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©",
                img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&w=600&q=80",
                desc: "Ø£Ø¶Ø®Ù… ØªØ¬Ù…Ø¹ Ù„Ø¹Ø´Ø§Ù‚ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©ØŒ Ù…Ù‚Ø§Ø¨Ù„Ø§Øª ÙˆÙ„Ø§Ù†Ø§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†.",
                tags: ["Ø£Ù„Ø¹Ø§Ø¨", "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§"],
                members: "1.2k",
                type: "public",
                password: null
            },
            {
                id: 2,
                name: "Sudan Coffee Lovers",
                img: "https://images.unsplash.com/photo-1497935586351-b67a49e012bf?auto=format&fit=crop&w=600&q=80",
                desc: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø®Ø§ØµØ© Ù„Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø°ÙˆÙ‚ Ø§Ù„Ø±ÙÙŠØ¹ ÙÙŠ Ø§Ù„Ù‚Ù‡ÙˆØ©ØŒ Ù†Ù„ØªÙ‚ÙŠ ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹.",
                tags: ["Ù‚Ù‡ÙˆØ©", "Ø·Ø¹Ø§Ù…"],
                members: "350",
                type: "private",
                password: "coffee123" // Default password
            },
            {
                id: 3,
                name: "Ù‚Ø±Ø§Ø¡ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†",
                img: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?auto=format&fit=crop&w=600&q=80",
                desc: "Ù†Ù†Ø§Ù‚Ø´ Ø£ÙØ¶Ù„ Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ§Ù„ÙƒØªØ¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø´Ù‡Ø±ÙŠØ§Ù‹.",
                tags: ["ÙƒØªØ¨", "Ø«Ù‚Ø§ÙØ©"],
                members: "890",
                type: "public",
                password: null
            },
            {
                id: 4,
                name: "Ø§Ù„Ù€ Tribly Secret",
                img: "https://images.unsplash.com/photo-1511632765486-a01980e01a18?auto=format&fit=crop&w=600&q=80",
                desc: "Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø³Ø±ÙŠ Ù„Ù…Ø·ÙˆØ±ÙŠ ÙˆÙ…Ø­Ø¨ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ù„Ù„ØºØ±Ø¨Ø§Ø¡.",
                tags: ["ØªØ·ÙˆÙŠØ±", "Ø³Ø±ÙŠ"],
                members: "15",
                type: "private",
                password: "tribly"
            }
        ];

        // Load saved passwords from localStorage
        function loadCommunities() {
            const saved = localStorage.getItem('tribly_communities');
            if (saved) {
                communities = JSON.parse(saved);
            }
            renderGrid();
            populateAdminSelect();
        }

        // --- Render Functions ---
        function renderGrid() {
            const grid = document.getElementById('communitiesGrid');
            grid.innerHTML = '';

            communities.forEach(comm => {
                const isLocked = comm.type === 'private';
                
                const cardHTML = `
                    <div class="card" onclick="handleCardClick(${comm.id})">
                        <div class="card-img-wrapper">
                            <img src="${comm.img}" class="card-img" alt="${comm.name}">
                            ${isLocked ? `
                                <div class="lock-badge">
                                    <i class="fas fa-lock"></i> Ø®Ø§Øµ
                                </div>
                            ` : ''}
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${comm.name}</h3>
                            <div class="tags">
                                ${comm.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                            </div>
                            <p class="card-desc">${comm.desc}</p>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; font-size:0.9rem; color:#888;">
                                <span><i class="fas fa-users"></i> ${comm.members} Ø¹Ø¶Ùˆ</span>
                            </div>
                            <button class="join-btn ${isLocked ? 'locked' : ''}">
                                ${isLocked ? '<i class="fas fa-key"></i> Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„' : '<i class="fas fa-plus"></i> Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†'}
                            </button>
                        </div>
                    </div>
                `;
                grid.innerHTML += cardHTML;
            });
        }

        function populateAdminSelect() {
            const select = document.getElementById('adminCommunitySelect');
            select.innerHTML = '';
            communities.forEach(comm => {
                const option = document.createElement('option');
                option.value = comm.id;
                option.text = comm.name + (comm.type === 'private' ? ' (Ø®Ø§Øµ)' : ' (Ø¹Ø§Ù…)');
                select.appendChild(option);
            });
        }

        // --- Interaction Logic ---
        let selectedCommunityId = null;

        function handleCardClick(id) {
            const comm = communities.find(c => c.id === id);
            selectedCommunityId = id;

            if (comm.type === 'public') {
                // 1. Ø±Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø¨ØµÙØ­Ø© Ø§Ù„Ø´Ø§Øª (Public)
                window.location.href = `chat.html?id=${comm.id}`;
            } else {
                // Open Password Modal
                document.getElementById('lockedCommunityName').textContent = `Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹ "${comm.name}"`;
                document.getElementById('communityPasswordInput').value = '';
                openModal('passwordModal');
            }
        }

        function verifyPassword() {
            const input = document.getElementById('communityPasswordInput').value;
            const comm = communities.find(c => c.id === selectedCommunityId);

            if (input === comm.password) {
                closeModal('passwordModal');
                // 2. Ø±Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø¨ØµÙØ­Ø© Ø§Ù„Ø´Ø§Øª (Private - After Pass)
                window.location.href = `chat.html?id=${comm.id}`;
            } else {
                const modal = document.querySelector('#passwordModal .modal');
                modal.classList.add('shake');
                setTimeout(() => modal.classList.remove('shake'), 500);
                showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        }

        // --- Admin Functions ---
        function openAdminPanel() {
            openModal('adminModal');
        }

        function saveAdminPassword() {
            const id = parseInt(document.getElementById('adminCommunitySelect').value);
            const newPass = document.getElementById('newAdminPassword').value;
            
            if (!newPass) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±', 'error');
                return;
            }

            const commIndex = communities.findIndex(c => c.id === id);
            if (commIndex > -1) {
                // Update password and type to private
                communities[commIndex].password = newPass;
                communities[commIndex].type = 'private';
                
                // Save to storage
                localStorage.setItem('tribly_communities', JSON.stringify(communities));
                
                renderGrid();
                closeModal('adminModal');
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('newAdminPassword').value = '';
            }
        }

        // --- UI Helpers ---
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMessage');
            
            toast.className = 'toast show ' + type;
            toastMsg.textContent = msg;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Add Shake Animation in JS
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            .shake { animation: shake 0.3s ease-in-out; }
        `;
        document.head.appendChild(styleSheet);

        // Initialize
        window.onload = loadCommunities;

    </script>
</body>
</html>