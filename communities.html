<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0">
  <meta name="theme-color" content="#6ae44d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª - Tribly</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      color: #333;
    }

    /* Navbar */
    nav {
      background: white;
      padding: 1rem 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: #6ae44d;
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    .nav-links a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: #6ae44d;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .profile {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #6ae44d;
    }

    /* Main Container */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .page-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .page-header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: #222;
    }

    .page-header p {
      font-size: 1.1rem;
      color: #666;
    }

    /* Filter Section */
    .filter-section {
      background: white;
      padding: 1.5rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .filter-btn {
      padding: 0.75rem 1.5rem;
      border: 2px solid #ddd;
      background: white;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .filter-btn.active {
      background: #6ae44d;
      color: white;
      border-color: #6ae44d;
    }

    .filter-btn:hover {
      border-color: #6ae44d;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
    }

    .search-box input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 25px;
      font-size: 1rem;
      transition: border 0.3s;
    }

    .search-box input:focus {
      outline: none;
      border-color: #6ae44d;
    }

    /* Communities Grid */
    .communities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    /* Community Card */
    .community-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s;
      cursor: pointer;
    }

    .community-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .community-header {
      background: linear-gradient(135deg, #6ae44d, #a5ff84);
      padding: 2rem;
      position: relative;
      min-height: 150px;
      display: flex;
      align-items: flex-end;
    }

    .community-header.private {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .community-icon {
      font-size: 3rem;
      color: white;
      margin-bottom: 1rem;
    }

    .community-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255,255,255,0.9);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .community-badge.public {
      color: #6ae44d;
    }

    .community-badge.private {
      color: #667eea;
    }

    .community-info {
      padding: 1.5rem;
    }

    .community-name {
      font-size: 1.5rem;
      font-weight: bold;
      color: #222;
      margin-bottom: 0.5rem;
    }

    .community-desc {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 1rem;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .community-stats {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .stat {
      flex: 1;
      text-align: center;
    }

    .stat-number {
      font-size: 1.3rem;
      font-weight: bold;
      color: #6ae44d;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #999;
      margin-top: 0.25rem;
    }

    .community-footer {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: #6ae44d;
      color: white;
    }

    .btn-primary:hover {
      background: #5ac93d;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #eee;
    }

    .modal-header h2 {
      font-size: 1.5rem;
      color: #222;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #6ae44d;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Community Detail View */
    .community-detail {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .detail-header {
      background: linear-gradient(135deg, #6ae44d, #a5ff84);
      padding: 2rem;
      color: white;
    }

    .detail-header.private {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .detail-content {
      padding: 2rem;
    }

    .detail-section {
      margin-bottom: 2rem;
    }

    .detail-section h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: #222;
    }

    .members-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }

    .member-card {
      background: #f5f5f5;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .member-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #ddd;
      margin: 0 auto 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .member-name {
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
    }

    .member-role {
      font-size: 0.75rem;
      color: #999;
      margin-top: 0.25rem;
    }

    /* Messages/Posts Section */
    .chat-section {
      background: #f9f9f9;
      border-radius: 15px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .message {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      border-left: 4px solid #6ae44d;
    }

    .message-author {
      font-weight: 600;
      color: #333;
      margin-bottom: 0.25rem;
    }

    .message-time {
      font-size: 0.8rem;
      color: #999;
    }

    .message-content {
      margin-top: 0.5rem;
      color: #666;
      line-height: 1.5;
    }

    .message-input {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .message-input input {
      flex: 1;
      padding: 0.75rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }

    .message-input button {
      background: #6ae44d;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .message-input button:hover {
      background: #5ac93d;
    }

    .permission-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: #f0f0f0;
      border-radius: 5px;
      font-size: 0.75rem;
      margin-left: 0.5rem;
    }

    .permission-badge.moderator {
      background: #ffe0e0;
      color: #e74c3c;
    }

    .permission-badge.member {
      background: #e0f0ff;
      color: #3498db;
    }

    /* Share Section */
    .share-section {
      background: linear-gradient(135deg, rgba(106, 228, 77, 0.1), rgba(165, 255, 132, 0.1));
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 2px dashed #6ae44d;
    }

    .share-title {
      font-weight: 600;
      color: #222;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .share-link-container {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      background: white;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 2px solid #ddd;
    }

    .share-link-container input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 0.95rem;
      color: #333;
    }

    .copy-btn {
      background: #6ae44d;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .copy-btn:hover {
      background: #5ac93d;
      transform: scale(1.05);
    }

    .copy-btn.copied {
      background: #27ae60;
    }

    .share-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .share-btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .share-btn-whatsapp {
      background: #25d366;
      color: white;
    }

    .share-btn-whatsapp:hover {
      background: #1fbe5f;
    }

    .share-btn-twitter {
      background: #1da1f2;
      color: white;
    }

    .share-btn-twitter:hover {
      background: #1a91da;
    }

    .share-btn-email {
      background: #ea4335;
      color: white;
    }

    .share-btn-email:hover {
      background: #d33426;
    }

    /* Message Styling */
    .message-bubble {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      border-left: 4px solid #6ae44d;
      transition: all 0.3s;
    }

    .message-bubble:hover {
      box-shadow: 0 4px 12px rgba(106, 228, 77, 0.15);
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .message-author {
      font-weight: 700;
      color: #6ae44d;
      font-size: 1rem;
    }

    .message-time {
      font-size: 0.75rem;
      color: #999;
    }

    .message-content {
      color: #333;
      line-height: 1.6;
      margin-top: 0.5rem;
      word-wrap: break-word;
    }

    /* Chat Container */
    .chat-container {
      background: #f5f5f5;
      border-radius: 12px;
      padding: 1.5rem;
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .empty-chat {
      text-align: center;
      color: #999;
      padding: 2rem;
      font-style: italic;
    }

    .input-group {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .input-group input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #6ae44d;
      box-shadow: 0 0 8px rgba(106, 228, 77, 0.2);
    }

    .input-group button {
      background: #6ae44d;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    .input-group button:hover {
      background: #5ac93d;
      transform: translateY(-2px);
    }

    .input-group button:active {
      transform: translateY(0);
    }

    /* Responsive */
    @media (max-width: 768px) {
      nav {
        padding: 1rem;
      }

      .nav-links {
        display: none;
      }

      .page-header h1 {
        font-size: 1.8rem;
      }

      .communities-grid {
        grid-template-columns: 1fr;
      }

      .filter-section {
        flex-direction: column;
      }

      .search-box {
        width: 100%;
      }

      .detail-header {
        padding: 1.5rem;
      }

      .detail-content {
        padding: 1rem;
      }

      .members-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .page-header h1 {
        font-size: 1.5rem;
      }

      .community-card {
        border-radius: 10px;
      }

      .modal-content {
        padding: 1.5rem;
        width: 95%;
      }

      .members-list {
        grid-template-columns: 1fr;
      }
    }

    /* Auth Modal */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 3000;
      align-items: center;
      justify-content: center;
    }

    .auth-modal.active {
      display: flex;
    }

    .auth-content {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }

    .auth-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .auth-btn {
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .auth-btn-google {
      background: #fff;
      color: #333;
      border: 2px solid #ddd;
    }

    .auth-btn-google:hover {
      background: #f5f5f5;
      border-color: #db4437;
    }

    .auth-btn-email {
      background: #6ae44d;
      color: white;
    }

    .auth-btn-email:hover {
      background: #5ac93d;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ae44d, #a5ff84);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .user-name {
      font-size: 0.9rem;
      color: #333;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <a href="index.html" class="logo">Tribly</a>
    <ul class="nav-links">
      <li><a href="home.html">Ø§Ù„ØªØµÙØ­</a></li>
      <li><a href="communities.html" style="color: #6ae44d;">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª</a></li>
      <li><a href="faq.html">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</a></li>
      <li><a href="support.html">Ø§Ù„Ø¯Ø¹Ù…</a></li>
      <li><a href="about.html">Ø­ÙˆÙ„</a></li>
    </ul>
    <div class="nav-actions">
      <div id="userProfile" class="user-profile" onclick="toggleUserMenu()">
        <div class="user-avatar" id="userAvatar">?</div>
        <span class="user-name" id="userName">Ø²Ø§Ø¦Ø±</span>
      </div>
      <button class="menu-btn" id="menuBtn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>

  <!-- Auth Modal -->
  <div class="auth-modal" id="authModal">
    <div class="auth-content">
      <h2 style="margin-bottom: 1rem; color: #333;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Tribly</h2>
      <p style="color: #666; margin-bottom: 1.5rem;">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</p>
      
      <div class="auth-options">
        <button class="auth-btn auth-btn-google" onclick="signInWithGoogle()">
          <i class="fab fa-google" style="color: #DB4437;"></i>
          Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
        </button>
        <button class="auth-btn auth-btn-email" onclick="signInWithEmail()">
          <i class="fas fa-envelope"></i>
          Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        </button>
      </div>
      
      <p style="margin-top: 1.5rem; font-size: 0.8rem; color: #999;">
        Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" style="color: #6ae44d;">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a> Ùˆ <a href="#" style="color: #6ae44d;">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>ğŸŒ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª</h1>
      <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ø§Øª ØªØ´Ø§Ø±ÙƒÙƒ Ù†ÙØ³ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</p>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <button class="filter-btn active" onclick="filterCommunities('all'); return false;">Ø§Ù„ÙƒÙ„</button>
      <button class="filter-btn" onclick="filterCommunities('public'); return false;">
        <i class="fas fa-globe"></i> Ø¹Ø§Ù…
      </button>
      <button class="filter-btn" onclick="filterCommunities('private'); return false;">
        <i class="fas fa-lock"></i> Ø®Ø§Øµ
      </button>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬ØªÙ…Ø¹..." oninput="searchCommunities(); return false;">
      </div>
      <button class="btn btn-primary" onclick="openCreateModal(); return false;" style="width: auto;">
        <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬ØªÙ…Ø¹
      </button>
    </div>

    <!-- Communities Grid -->
    <div class="communities-grid" id="communitiesGrid">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø£Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
    </div>
  </div>

  <!-- Community Detail Modal -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="detailTitle">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</h2>
        <button class="close-btn" onclick="closeDetail()">&times;</button>
      </div>
      <div class="community-detail" id="detailContent">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø£Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
      </div>
    </div>
  </div>

  <!-- Create/Edit Community Modal -->
  <div class="modal" id="createModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬ØªÙ…Ø¹ Ø¬Ø¯ÙŠØ¯</h2>
        <button class="close-btn" onclick="closeCreateModal()">&times;</button>
      </div>
      <form id="communityForm">
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ *</label>
          <input type="text" id="communityName" required>
        </div>

        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ *</label>
          <textarea id="communityDesc" required></textarea>
        </div>

        <div class="form-group">
          <label>Ø§Ù„Ù†ÙˆØ¹ *</label>
          <select id="communityType" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
            <option value="public">Ø¹Ø§Ù… (Ù…ÙØªÙˆØ­ Ù„Ù„Ø¬Ù…ÙŠØ¹)</option>
            <option value="private">Ø®Ø§Øµ (ÙŠØªØ·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø³Ø±)</option>
          </select>
        </div>

        <div class="form-group" id="passwordGroup" style="display: none;">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± *</label>
          <input type="password" id="communityPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ù‚ÙˆÙŠØ©">
        </div>

        <div class="form-group">
          <label>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ø±Ù…Ø² ØªØ¹Ø¨ÙŠØ±ÙŠ)</label>
          <input type="text" id="communityIcon" placeholder="Ù…Ø«Ø§Ù„: ğŸ® ğŸµ âš½" value="ğŸ‘¥">
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="allowMemberMessaging">
            Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø§Ù„ØªØ­Ø¯Ø« (ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† ØªØºÙŠÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
          </label>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">
          Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
        </button>
      </form>
    </div>
  </div>

  <!-- Join Private Community Modal -->
  <div class="modal" id="joinPrivateModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹ Ø®Ø§Øµ</h2>
        <button class="close-btn" onclick="closeJoinModal()">&times;</button>
      </div>
      <form id="joinForm">
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input type="password" id="joinPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">
          Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        </button>
      </form>
    </div>
  </div>

  <!-- Email Sign-in Modal -->
  <div class="modal" id="emailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
        <button class="close-btn" onclick="closeEmailModal()">&times;</button>
      </div>
      <form id="emailForm">
        <div class="form-group">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="emailInput" placeholder="example@email.com" required>
        </div>
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
          <button type="button" class="btn btn-secondary" onclick="showRegister()" style="flex: 1;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>
      </form>
      <div id="registerForm" style="display: none;">
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input type="text" id="registerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="registerEmail" placeholder="example@email.com">
        </div>
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input type="password" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ù‚ÙˆÙŠØ©">
        </div>
        <button class="btn btn-primary" onclick="registerWithEmail()" style="width: 100%;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCo7Hlzb0-C1v6C9rdDbzVg_Nvp_J1MW64",
      authDomain: "tribly-app.firebaseapp.com",
      databaseURL: "https://tribly-app-default-rtdb.firebaseio.com",
      projectId: "tribly-app",
      storageBucket: "tribly-app.appspot.com",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:abc123def456ghi789"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
    let communities = {};
    let currentUser = null;
    let currentFilter = 'all';
    let userCommunities = {};
    let realTimeListeners = {};

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      setupEventListeners();
      checkUrlForCommunity();
    });

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    function checkAuth() {
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          currentUser = {
            uid: user.uid,
            name: user.displayName || user.email?.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…',
            email: user.email,
            avatar: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=6ae44d&color=fff`
          };
          updateUserUI();
          await loadUserCommunities();
          await loadCommunities();
          renderCommunities();
        } else {
          currentUser = null;
          updateUserUI();
          showAuthModal();
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateUserUI() {
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const userProfile = document.getElementById('userProfile');

      if (currentUser) {
        userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
        userName.textContent = currentUser.name;
        userAvatar.style.background = `linear-gradient(135deg, #6ae44d, #a5ff84)`;
      } else {
        userAvatar.textContent = '?';
        userName.textContent = 'Ø²Ø§Ø¦Ø±';
        userAvatar.style.background = '#ddd';
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function loadUserCommunities() {
      if (!currentUser) return;
      
      const snapshot = await db.ref(`userCommunities/${currentUser.uid}`).once('value');
      userCommunities = snapshot.val() || {};
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª
    async function loadCommunities() {
      const snapshot = await db.ref('communities').once('value');
      communities = snapshot.val() || {};
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª
    function renderCommunities() {
      const grid = document.getElementById('communitiesGrid');
      grid.innerHTML = '';

      let filteredCommunities = Object.values(communities);

      // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
      if (currentFilter === 'public') {
        filteredCommunities = filteredCommunities.filter(c => c.type === 'public');
      } else if (currentFilter === 'private') {
        filteredCommunities = filteredCommunities.filter(c => c.type === 'private');
      }

      // Ø§Ù„Ø¨Ø­Ø«
      const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
      if (searchTerm) {
        filteredCommunities = filteredCommunities.filter(c =>
          c.name.toLowerCase().includes(searchTerm) ||
          c.desc.toLowerCase().includes(searchTerm)
        );
      }

      if (filteredCommunities.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ø§Øª</div>';
        return;
      }

      // ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
      filteredCommunities.sort((a, b) => b.createdAt - a.createdAt);

      filteredCommunities.forEach(community => {
        const isJoined = currentUser ? (userCommunities[community.id] || false) : false;
        const card = document.createElement('div');
        card.className = 'community-card';

        const badgeClass = community.type === 'public' ? 'public' : 'private';
        const badgeIcon = community.type === 'public' ? 'ğŸŒ' : 'ğŸ”’';
        const badgeText = community.type === 'public' ? 'Ø¹Ø§Ù…' : 'Ø®Ø§Øµ';

        card.innerHTML = `
          <div class="community-header ${community.type}" onclick="showCommunityDetail('${community.id}')">
            <div class="community-badge ${badgeClass}">
              ${badgeIcon} ${badgeText}
            </div>
            <div class="community-icon">${community.icon || 'ğŸ‘¥'}</div>
          </div>
          <div class="community-info">
            <div class="community-name" onclick="showCommunityDetail('${community.id}')" style="cursor: pointer;">${community.name}</div>
            <div class="community-desc">${community.desc}</div>
            <div class="community-stats">
              <div class="stat">
                <div class="stat-number">${community.memberCount || 1}</div>
                <div class="stat-label">Ø¹Ø¶Ùˆ</div>
              </div>
              <div class="stat">
                <div class="stat-number">${community.messageCount || 0}</div>
                <div class="stat-label">Ø±Ø³Ø§Ù„Ø©</div>
              </div>
              <div class="stat">
                <div class="stat-number">${community.moderators?.length || 1}</div>
                <div class="stat-label">Ù…Ø´Ø±Ù</div>
              </div>
            </div>
            <div class="community-footer">
              <button class="btn ${isJoined ? 'btn-secondary' : 'btn-primary'}"
                      onclick="handleCommunityAction('${community.id}', ${isJoined})" ${!currentUser ? 'disabled' : ''}>
                <i class="fas fa-${isJoined ? 'check' : 'plus'}"></i>
                ${isJoined ? 'Ø¹Ø¶Ùˆ' : (currentUser ? 'Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†' : 'Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„')}
              </button>
              <button class="btn btn-secondary" onclick="showCommunityDetail('${community.id}')">
                <i class="fas fa-arrow-left"></i> Ø¹Ø±Ø¶
              </button>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª
    function filterCommunities(type) {
      currentFilter = type;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      renderCommunities();
      return false;
    }

    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª
    function searchCommunities() {
      renderCommunities();
      return false;
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù†Ø¶Ù…Ø§Ù…/Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    async function handleCommunityAction(communityId, isJoined) {
      if (!currentUser) {
        showAuthModal();
        return;
      }

      if (isJoined) {
        // Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
        await leaveCommunity(communityId);
      } else {
        // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹
        const community = communities[communityId];
        if (community.type === 'private') {
          openJoinModal(communityId);
        } else {
          await joinCommunity(communityId);
        }
      }
    }

    // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹
    async function joinCommunity(communityId) {
      if (!currentUser) return;

      try {
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await db.ref(`userCommunities/${currentUser.uid}/${communityId}`).set(true);
        
        // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        const communityRef = db.ref(`communities/${communityId}`);
        const snapshot = await communityRef.once('value');
        const community = snapshot.val();
        
        const newMemberCount = (community.memberCount || 1) + 1;
        await communityRef.update({ memberCount: newMemberCount });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        userCommunities[communityId] = true;
        if (communities[communityId]) {
          communities[communityId].memberCount = newMemberCount;
        }
        
        renderCommunities();
        showCommunityDetail(communityId);
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        await addSystemMessage(communityId, `ğŸ‰ Ø§Ù†Ø¶Ù… ${currentUser.name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹!`);
        
      } catch (error) {
        console.error('Error joining community:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹');
      }
    }

    // Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    async function leaveCommunity(communityId) {
      if (!currentUser) return;

      try {
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await db.ref(`userCommunities/${currentUser.uid}/${communityId}`).remove();
        
        // ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        const communityRef = db.ref(`communities/${communityId}`);
        const snapshot = await communityRef.once('value');
        const community = snapshot.val();
        
        const newMemberCount = Math.max(0, (community.memberCount || 1) - 1);
        await communityRef.update({ memberCount: newMemberCount });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        delete userCommunities[communityId];
        if (communities[communityId]) {
          communities[communityId].memberCount = newMemberCount;
        }
        
        renderCommunities();
        closeDetail();
        
      } catch (error) {
        console.error('Error leaving community:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹');
      }
    }

    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    async function showCommunityDetail(communityId) {
      if (!currentUser) {
        showAuthModal();
        return;
      }

      const community = communities[communityId];
      if (!community) {
        alert('Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        return;
      }

      const modal = document.getElementById('detailModal');
      const isJoined = userCommunities[communityId] || false;
      const isModerator = community.moderators?.includes(currentUser.uid);
      const canMessage = isJoined && (community.allowMemberMessaging || isModerator);

      document.getElementById('detailTitle').textContent = `${community.icon || 'ğŸ‘¥'} ${community.name}`;

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
      await loadCommunityMessages(communityId);

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      setupMessageListener(communityId);

      // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
      const communityLink = `${window.location.origin}${window.location.pathname}?community=${communityId}`;
      const encodedLink = encodeURIComponent(communityLink);
      const shareText = `Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹ "${community.name}" Ø¹Ù„Ù‰ Tribly`;

      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
      let moderatorsHtml = '';
      if (community.moderators) {
        for (const modId of community.moderators) {
          const userSnapshot = await db.ref(`users/${modId}`).once('value');
          const user = userSnapshot.val();
          if (user) {
            moderatorsHtml += `
              <div class="member-card">
                <div class="member-avatar" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                  ${user.name?.charAt(0)?.toUpperCase() || '?'}
                </div>
                <div class="member-name">${user.name || 'Ù…Ø´Ø±Ù'}</div>
                <div class="member-role">Ù…Ø´Ø±Ù</div>
              </div>
            `;
          }
        }
      }

      document.getElementById('detailContent').innerHTML = `
        <div class="detail-header ${community.type}">
          <h1>${community.icon || 'ğŸ‘¥'} ${community.name}</h1>
          <p>${community.desc}</p>
        </div>
        <div class="detail-content">
          
          ${isJoined ? `
          <div class="share-section">
            <div class="share-title">
              <i class="fas fa-share-alt"></i> Ø´Ø§Ø±Ùƒ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ
            </div>
            <div class="share-link-container">
              <input type="text" value="${communityLink}" readonly id="communityLinkInput">
              <button class="copy-btn" onclick="copyCommunityLink('${communityLink}')">
                <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
              </button>
            </div>
            <div class="share-buttons">
              <button class="share-btn share-btn-whatsapp" onclick="shareWhatsApp('${shareText}', '${encodedLink}')">
                <i class="fab fa-whatsapp"></i> WhatsApp
              </button>
              <button class="share-btn share-btn-twitter" onclick="shareTwitter('${shareText}', '${encodedLink}')">
                <i class="fab fa-twitter"></i> X/ØªÙˆÙŠØªØ±
              </button>
              <button class="share-btn share-btn-email" onclick="shareEmail('${shareText}', '${communityLink}')">
                <i class="fas fa-envelope"></i> Ø§ÙŠÙ…ÙŠÙ„
              </button>
            </div>
          </div>
          ` : ''}

          <div class="detail-section">
            <h3>â„¹ï¸ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</h3>
            <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${community.type === 'public' ? 'ğŸŒ Ø¹Ø§Ù…' : 'ğŸ”’ Ø®Ø§Øµ'}</p>
            <p><strong>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡:</strong> ${community.memberCount || 1}</p>
            <p><strong>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</strong> ${community.messageCount || 0}</p>
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯Ø«:</strong> ${community.allowMemberMessaging ? 'âœ… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„ØªØ­Ø¯Ø«' : 'ğŸ”‡ ÙÙ‚Ø· Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†'}</p>
            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${formatDate(community.createdAt)}</p>
          </div>

          <div class="detail-section">
            <h3>ğŸ‘¥ Ø§Ù„Ù…Ø´Ø±ÙÙˆÙ†</h3>
            <div class="members-list">
              ${moderatorsHtml || '<p style="color: #999; text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙÙŠÙ†</p>'}
            </div>
          </div>

          ${isJoined ? `
          <div class="detail-section">
            <h3>ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
            <div class="chat-container" id="messagesContainer">
              <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            </div>
            ${canMessage ? `
            <div class="input-group">
              <input type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†..." id="msgInput" onkeypress="handleEnter(event, '${communityId}')">
              <button onclick="sendMessage('${communityId}')">
                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
              </button>
            </div>
            ` : '<p style="color: #999; font-size: 0.9rem; text-align: center; padding: 1rem; background: #f5f5f5; border-radius: 8px;">ğŸ”’ Ø£Ù†Øª Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ­Ø¯Ø« ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</p>'}
          </div>
          ` : '<div style="text-align: center; padding: 2rem; background: #f5f5f5; border-radius: 8px;"><p style="color: #999; margin-bottom: 1rem;">âš ï¸ Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹ Ù„ØªØ±Ù‰ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</p></div>'}
          
          ${isJoined ? `
          <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-secondary" onclick="leaveCommunity('${communityId}')" style="width: auto;">
              <i class="fas fa-sign-out-alt"></i> Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
            </button>
          </div>
          ` : ''}
        </div>
      `;

      modal.classList.add('active');
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
      await renderMessages(communityId);
      
      // ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
      setTimeout(() => {
        const container = document.getElementById('messagesContainer');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      }, 100);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    async function loadCommunityMessages(communityId) {
      const snapshot = await db.ref(`messages/${communityId}`).once('value');
      return snapshot.val() || {};
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    async function renderMessages(communityId) {
      const container = document.getElementById('messagesContainer');
      if (!container) return;

      const messages = await loadCommunityMessages(communityId);
      
      if (!messages || Object.keys(messages).length === 0) {
        container.innerHTML = '<div class="empty-chat">ğŸ™Œ ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø©!</div>';
        return;
      }

      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù…ØµÙÙˆÙØ© ÙˆÙØ±Ø²Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
      const messagesArray = Object.values(messages).sort((a, b) => a.timestamp - b.timestamp);
      
      let messagesHtml = '';
      for (const msg of messagesArray) {
        const userSnapshot = await db.ref(`users/${msg.userId}`).once('value');
        const user = userSnapshot.val();
        const isSystem = msg.type === 'system';
        
        messagesHtml += `
          <div class="message-bubble" style="${isSystem ? 'border-left-color: #999; background: #f9f9f9;' : ''}">
            <div class="message-header">
              <span class="message-author" style="${isSystem ? 'color: #999;' : ''}">
                ${isSystem ? 'ğŸ””' : ''} ${user?.name || 'Ù…Ø³ØªØ®Ø¯Ù…'}
              </span>
              <span class="message-time">${formatTime(msg.timestamp)}</span>
            </div>
            <div class="message-content" style="${isSystem ? 'color: #666; font-style: italic;' : ''}">
              ${msg.text}
            </div>
          </div>
        `;
      }

      container.innerHTML = messagesHtml;
      
      // ØªÙ…Ø±ÙŠØ± Ù„Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
      setTimeout(() => {
        container.scrollTop = container.scrollHeight;
      }, 100);
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    function setupMessageListener(communityId) {
      // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹ Ø³Ø§Ø¨Ù‚
      if (realTimeListeners[communityId]) {
        realTimeListeners[communityId]();
      }

      const messagesRef = db.ref(`messages/${communityId}`);
      realTimeListeners[communityId] = messagesRef.on('child_added', async (snapshot) => {
        const msg = snapshot.val();
        const container = document.getElementById('messagesContainer');
        
        if (container && !container.innerHTML.includes('empty-chat')) {
          const userSnapshot = await db.ref(`users/${msg.userId}`).once('value');
          const user = userSnapshot.val();
          const isSystem = msg.type === 'system';
          
          const messageHtml = `
            <div class="message-bubble" style="${isSystem ? 'border-left-color: #999; background: #f9f9f9;' : ''}">
              <div class="message-header">
                <span class="message-author" style="${isSystem ? 'color: #999;' : ''}">
                  ${isSystem ? 'ğŸ””' : ''} ${user?.name || 'Ù…Ø³ØªØ®Ø¯Ù…'}
                </span>
                <span class="message-time">${formatTime(msg.timestamp)}</span>
              </div>
              <div class="message-content" style="${isSystem ? 'color: #666; font-style: italic;' : ''}">
                ${msg.text}
              </div>
            </div>
          `;
          
          container.innerHTML += messageHtml;
          container.scrollTop = container.scrollHeight;
        }
      });
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    async function sendMessage(communityId) {
      if (!currentUser) {
        showAuthModal();
        return;
      }

      const msgInput = document.getElementById('msgInput');
      const message = msgInput.value.trim();
      
      if (!message) return;

      const community = communities[communityId];
      const isJoined = userCommunities[communityId] || false;
      const isModerator = community.moderators?.includes(currentUser.uid);
      const canMessage = isJoined && (community.allowMemberMessaging || isModerator);

      if (!canMessage) {
        alert('âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ­Ø¯Ø« ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹');
        return;
      }

      try {
        // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const messageRef = db.ref(`messages/${communityId}`).push();
        await messageRef.set({
          userId: currentUser.uid,
          text: message,
          timestamp: Date.now(),
          type: 'message'
        });

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        const communityRef = db.ref(`communities/${communityId}`);
        const snapshot = await communityRef.once('value');
        const communityData = snapshot.val();
        
        const newMessageCount = (communityData.messageCount || 0) + 1;
        await communityRef.update({ messageCount: newMessageCount });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        if (communities[communityId]) {
          communities[communityId].messageCount = newMessageCount;
        }

        msgInput.value = '';
        
      } catch (error) {
        console.error('Error sending message:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
      }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
    async function addSystemMessage(communityId, text) {
      const messageRef = db.ref(`messages/${communityId}`).push();
      await messageRef.set({
        userId: 'system',
        text: text,
        timestamp: Date.now(),
        type: 'system'
      });
    }

    // Ø¥ØºÙ„Ø§Ù‚ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    function closeDetail() {
      const modal = document.getElementById('detailModal');
      modal.classList.remove('active');
      
      // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
      Object.values(realTimeListeners).forEach(unsubscribe => {
        if (typeof unsubscribe === 'function') unsubscribe();
      });
      realTimeListeners = {};
    }

    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    function openCreateModal() {
      if (!currentUser) {
        showAuthModal();
        return;
      }
      
      document.getElementById('modalTitle').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬ØªÙ…Ø¹ Ø¬Ø¯ÙŠØ¯';
      document.getElementById('communityForm').reset();
      document.getElementById('passwordGroup').style.display = 'none';
      document.getElementById('createModal').classList.add('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    function closeCreateModal() {
      document.getElementById('createModal').classList.remove('active');
    }

    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø®Ø§Øµ
    function openJoinModal(communityId) {
      document.getElementById('joinForm').dataset.communityId = communityId;
      document.getElementById('joinPrivateModal').classList.add('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
    function closeJoinModal() {
      document.getElementById('joinPrivateModal').classList.remove('active');
    }

    // Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
    function copyCommunityLink(link) {
      navigator.clipboard.writeText(link).then(() => {
        const btn = event.target.closest('.copy-btn');
        if (btn) {
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
          btn.classList.add('copied');
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('copied');
          }, 2000);
        }
      }).catch(err => {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
      });
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ WhatsApp
    function shareWhatsApp(text, link) {
      const message = `${text}\n${decodeURIComponent(link)}`;
      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ØªÙˆÙŠØªØ±
    function shareTwitter(text, link) {
      const tweetText = `${text} ${decodeURIComponent(link)}`;
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
      window.open(twitterUrl, '_blank');
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§ÙŠÙ…ÙŠÙ„
    function shareEmail(subject, link) {
      const emailBody = `Ø§Ø´ØªØ±Ùƒ Ù…Ø¹ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹:\n${decodeURIComponent(link)}`;
      const emailUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
      window.location.href = emailUrl;
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Enter Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
    function handleEnter(event, communityId) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage(communityId);
      }
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
    function formatTime(timestamp) {
      if (!timestamp) return 'Ø§Ù„Ø¢Ù†';
      
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (seconds < 60) return 'Ø§Ù„Ø¢Ù†';
      if (minutes < 60) return `Ù‚Ø¨Ù„ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
      if (hours < 24) return `Ù‚Ø¨Ù„ ${hours} Ø³Ø§Ø¹Ø©`;
      if (days < 7) return `Ù‚Ø¨Ù„ ${days} ÙŠÙˆÙ…`;
      
      return date.toLocaleDateString('ar-SA');
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function formatDate(timestamp) {
      if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      return new Date(timestamp).toLocaleDateString('ar-SA');
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    async function checkUrlForCommunity() {
      const urlParams = new URLSearchParams(window.location.search);
      const communityId = urlParams.get('community');
      
      if (communityId && currentUser) {
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
        await loadCommunities();
        if (communities[communityId]) {
          const community = communities[communityId];
          
          if (community.type === 'private') {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø®Ø§ØµØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (!userCommunities[communityId]) {
              openJoinModal(communityId);
            } else {
              showCommunityDetail(communityId);
            }
          } else {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø§Ù…ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
            showCommunityDetail(communityId);
          }
        }
      }
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function setupEventListeners() {
      // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
      document.getElementById('communityType')?.addEventListener('change', (e) => {
        const passwordGroup = document.getElementById('passwordGroup');
        passwordGroup.style.display = e.target.value === 'private' ? 'block' : 'none';
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
      document.getElementById('communityForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!currentUser) {
          showAuthModal();
          return;
        }

        const communityData = {
          name: document.getElementById('communityName').value,
          desc: document.getElementById('communityDesc').value,
          icon: document.getElementById('communityIcon').value || 'ğŸ‘¥',
          type: document.getElementById('communityType').value,
          allowMemberMessaging: document.getElementById('allowMemberMessaging').checked,
          moderators: [currentUser.uid],
          memberCount: 1,
          messageCount: 0,
          createdAt: Date.now(),
          createdBy: currentUser.uid
        };

        if (communityData.type === 'private') {
          const password = document.getElementById('communityPassword').value;
          if (!password) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø®Ø§Øµ');
            return;
          }
          communityData.password = password;
        }

        try {
          // Ø­ÙØ¸ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹
          const communityRef = db.ref('communities').push();
          const communityId = communityRef.key;
          await communityRef.set(communityData);
          
          // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØ¹Ø¶Ùˆ
          await db.ref(`userCommunities/${currentUser.uid}/${communityId}`).set(true);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
          communities[communityId] = communityData;
          userCommunities[communityId] = true;
          
          closeCreateModal();
          renderCommunities();
          showCommunityDetail(communityId);
          
          // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
          await addSystemMessage(communityId, `ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© ${currentUser.name}! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹.`);
          
          alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø¨Ù†Ø¬Ø§Ø­!');
          
        } catch (error) {
          console.error('Error creating community:', error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹');
        }
      });

      // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø®Ø§Øµ
      document.getElementById('joinForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const communityId = document.getElementById('joinForm').dataset.communityId;
        const password = document.getElementById('joinPassword').value;
        
        const community = communities[communityId];
        if (!community) {
          alert('Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
          return;
        }

        if (community.password === password) {
          await joinCommunity(communityId);
          closeJoinModal();
        } else {
          alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!');
        }
      });
    }

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    function showAuthModal() {
      document.getElementById('authModal').classList.add('active');
    }

    // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    function hideAuthModal() {
      document.getElementById('authModal').classList.remove('active');
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      provider.setCustomParameters({
        prompt: 'select_account'
      });
      
      auth.signInWithPopup(provider)
        .then((result) => {
          // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          const user = result.user;
          return db.ref(`users/${user.uid}`).set({
            uid: user.uid,
            name: user.displayName || user.email?.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…',
            email: user.email,
            photoURL: user.photoURL,
            lastLogin: Date.now()
          });
        })
        .then(() => {
          hideAuthModal();
        })
        .catch((error) => {
          console.error('Sign-in error:', error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
        });
    }

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    function signInWithEmail() {
      document.getElementById('emailModal').classList.add('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    function closeEmailModal() {
      document.getElementById('emailModal').classList.remove('active');
    }

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    function showRegister() {
      document.getElementById('emailForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'block';
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    document.getElementById('emailForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('emailInput').value;
      const password = document.getElementById('passwordInput').value;
      
      try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        closeEmailModal();
      } catch (error) {
        if (error.code === 'auth/user-not-found') {
          showRegister();
        } else {
          alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
        }
      }
    });

    // ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
    async function registerWithEmail() {
      const name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      
      if (!name || !email || !password) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
        return;
      }
      
      try {
        const result = await auth.createUserWithEmailAndPassword(email, password);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await result.user.updateProfile({
          displayName: name
        });
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await db.ref(`users/${result.user.uid}`).set({
          uid: result.user.uid,
          name: name,
          email: email,
          created: Date.now(),
          lastLogin: Date.now()
        });
        
        closeEmailModal();
      } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message);
      }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function toggleUserMenu() {
      if (!currentUser) {
        showAuthModal();
        return;
      }
      
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        auth.signOut().then(() => {
          window.location.reload();
        });
      }
    }
  </script>

  <!-- Footer -->
  <footer style="background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); color: #6ae44d; padding: 3rem 2rem; text-align: center; margin-top: 3rem;">
    <div style="max-width: 1200px; margin: 0 auto;">
      <h3 style="color: #6ae44d; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(106, 228, 77, 0.3);">Tribly</h3>
      <p style="margin-bottom: 1.5rem; color: #ccc;">Ø£ÙˆØ¬Ø¯ Ù‚Ø¨ÙŠÙ„ØªÙƒ - Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ø§Øª ØªØ´Ø§Ø±ÙƒÙƒ Ù†ÙØ³ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</p>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        <div>
          <h4 style="color: #6ae44d; margin-bottom: 1rem;">Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h4>
          <ul style="list-style: none; padding: 0;">
            <li style="margin-bottom: 0.5rem;"><a href="index.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="home.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø§Ù„ØªØµÙØ­</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="communities.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="profile.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a></li>
          </ul>
        </div>
        <div>
          <h4 style="color: #6ae44d; margin-bottom: 1rem;">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h4>
          <ul style="list-style: none; padding: 0;">
            <li style="margin-bottom: 0.5rem;"><a href="about.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø­ÙˆÙ„</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="manifesto.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø§Ù„Ø¨ÙŠØ§Ù†</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="privacy.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="service.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a></li>
          </ul>
        </div>
        <div>
          <h4 style="color: #6ae44d; margin-bottom: 1rem;">Ø§Ù„Ø¯Ø¹Ù…</h4>
          <ul style="list-style: none; padding: 0;">
            <li style="margin-bottom: 0.5rem;"><a href="support-site.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø¹Ù…</a></li>
            <li style="margin-bottom: 0.5rem;"><a href="contact-us.html" style="color: #ccc; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#6ae44d'" onmouseout="this.style.color='#ccc'">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
          </ul>
        </div>
      </div>
      <div style="border-top: 1px solid rgba(106, 228, 77, 0.3); padding-top: 1.5rem; color: #999;">
        <p>&copy; 2025 Tribly - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
      </div>
    </div>
  </footer>
</body>
</html>